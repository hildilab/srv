{% extends "MPPD_layout.html" %}
{% block title %}Grid{% endblock %}
{% block head %}
<link rel="stylesheet" href="{{ static('js/SlickGrid/slick.grid.css')}}" type="text/css"/>
<script src="{{ js('SlickGrid/lib/jquery-ui-1.8.16.custom.min.js')}}"></script>
<script src="{{ js('SlickGrid/lib/jquery.event.drag-2.2.js')}}"></script>
<script src="{{ js('SlickGrid/slick.core.js')}}"></script>
<script src="{{ js('SlickGrid/slick.grid.js')}}"></script>
<script src="{{ js('SlickGrid/plugins/slick.autotooltips.js')}}"></script>
<script src="{{ js('mppd.remotemodel.js')}}"></script>

{% endblock%}
{% block body %}

<div style="width:800px;float:left;">
  <div class="grid-header" style="width:100%">
        <span style="float:right;display:inline-block;">
          Search by PDB ID, keyword or classification:
          <input type="text" size=40 id="txtSearch" value="">
        </span>
  </div>
  <div id="myGrid" style="width:100%;height:600px;"></div>
</div>

<script>
  var grid;
  var loader = new Slick.Data.MppdRemoteModel();

  var dateFormatter = function (row, cell, value, columnDef, dataContext) {
    return value;
  };

  var columns = [
    { id: "pdb_id", name: "ID", field: "pdb_id", width: 60, sortable: true },
    { id: "pdb_title", name: "Title", field: "pdb_title", width: 150, sortable: true },
    { id: "pdb_keywords", name: "Keywords", field: "pdb_keywords", width: 150, sortable: true },
    { id: "pdb_experiment", name: "Experiment", field: "pdb_experiment", width: 150, sortable: true },
    { id: "pdb_resolution", name: "Resolution", field: "pdb_resolution", width: 50, sortable: true },
    
    { id: "opm_superfamily", name: "OPM Superfamily", field: "opm_superfamily", width: 150, sortable: true },
    { id: "opm_family", name: "OPM Family", field: "opm_family", width: 150, sortable: true },
    { id: "opm_reresentative", name: "OPM Representative", field: "opm_representative", width: 60, sortable: true },
    { id: "opm_species", name: "OPM Species", field: "opm_species", width: 150, sortable: true },
    { id: "opm_related", name: "OPM Related", field: "opm_related", width: 150, sortable: true },

    { id: "mpstruc_group", name: "MPstruc Group", field: "mpstruc_group", width: 150, sortable: true },
    { id: "mpstruc_subgroup", name: "MPstruc Subgroup", field: "mpstruc_subgroup", width: 150, sortable: true },
    { id: "mpstruc_name", name: "MPstruc Name", field: "mpstruc_name", width: 150, sortable: true },
    { id: "mpstruc_species", name: "MPstruc Species", field: "mpstruc_species", width: 150, sortable: true },
    { id: "mpstruc_master", name: "MPstruc Master", field: "mpstruc_master", width: 60, sortable: true },
    { id: "mpstruc_related", name: "MPstruc Related", field: "mpstruc_related", width: 150, sortable: true },

    { id: "curated_representative", name: "Curated Representative", field: "curated_representative", width: 60, sortable: true },
    { id: "curated_related", name: "Curated Related", field: "curated_related", width: 150, sortable: true },

    { id: "status", name: "Status", field: "status", width: 100, sortable: true },
  ];

  var options = {
    rowHeight: 24,
    editable: false,
    enableAddRow: false,
    enableCellNavigation: false,
    enableColumnReorder: false
  };

  var loadingIndicator = null;


  $(function () {
    grid = new Slick.Grid("#myGrid", loader.data, columns, options);

    grid.onViewportChanged.subscribe(function (e, args) {
      var vp = grid.getViewport();
      loader.ensureData(vp.top, vp.bottom);
    });

    grid.onSort.subscribe(function (e, args) {
      loader.setSort(args.sortCol.field, args.sortAsc ? 1 : -1);
      var vp = grid.getViewport();
      loader.ensureData(vp.top, vp.bottom);
    });

    loader.onDataLoading.subscribe(function () {
      if (!loadingIndicator) {
        loadingIndicator = $("<span class='loading-indicator'><label>Buffering...</label></span>").appendTo(document.body);
        var $g = $("#myGrid");

        loadingIndicator
            .css("position", "absolute")
            .css("top", $g.position().top + $g.height() / 2 - loadingIndicator.height() / 2)
            .css("left", $g.position().left + $g.width() / 2 - loadingIndicator.width() / 2);
      }

      loadingIndicator.show();
    });

    loader.onDataLoaded.subscribe(function (e, args) {
      for (var i = args.from; i <= args.to; i++) {
        grid.invalidateRow(i);
      }

      grid.updateRowCount();
      grid.render();

      loadingIndicator.fadeOut();
    });

    $("#txtSearch").keyup(function (e) {
      if (e.which == 13) {
        loader.setSearch($(this).val());
        var vp = grid.getViewport();
        loader.ensureData(vp.top, vp.bottom);
      }
    });

    loader.setSearch($("#txtSearch").val());
    loader.setSort("pdb_id", 1);

    grid.registerPlugin( 
    	new Slick.AutoTooltips({ enableForHeaderCells: true })
	);

    // load the first page
    grid.onViewportChanged.notify();
  })
</script>

{%endblock%}
