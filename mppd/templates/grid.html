{% extends "MPPD_layout.html" %}
{% block title %}Grid{% endblock %}
{% block head %}
<link rel="stylesheet" type="text/css" href="{{ url_dir + url_for('statisch',filename='tooltip.css')}}">
<link rel="stylesheet" href="{{ url_dir + url_for('statisch',filename='js/SlickGrid/slick.grid.css')}}" type="text/css"/>
<script src="{{ url_dir + url_for('statisch',filename='js/SlickGrid/lib/jquery-ui-1.8.16.custom.min.js')}}"></script>
<script src="{{ url_dir + url_for('statisch',filename='js/SlickGrid/lib/jquery.event.drag-2.2.js')}}"></script>
<script src="{{ url_dir + url_for('statisch',filename='js/SlickGrid/slick.core.js')}}"></script>
<script src="{{ url_dir + url_for('statisch',filename='js/SlickGrid/slick.grid.js')}}"></script>
<script src="{{ url_dir + url_for('statisch',filename='js/SlickGrid/plugins/slick.autotooltips.js')}}"></script>
<script src="{{ url_dir + url_for('statisch',filename='js/mppd.remotemodel.js')}}"></script>

{% endblock%}
{% block body %}

<div style="width:800px;float:left;">
  <div class="grid-header" style="width:100%">
        <span style="float:right;display:inline-block;">
          Search by PDB ID, keyword or classification:
          <input type="text" size=40 id="txtSearch" value="">
        </span>
  </div>
  <div id="myGrid" style="width:100%;height:600px;"></div>
</div>

<script>
  var grid;
  var loader = new Slick.Data.MppdRemoteModel();

  var dateFormatter = function (row, cell, value, columnDef, dataContext) {
    return value;
  };

  var columns = [
    { id: "pdbid", name: "PDB", field: "pdbid", width: 60, sortable: true },
    { id: "EXPDTA", name: "EXPDTA", field: "EXPDTA", width: 150, sortable: true },
    { id: "RESOLUTION", name: "RESOLUTION", field: "RESOLUTION", width: 50, sortable: true },
    { id: "SWfamily", name: "SWfamily", field: "SWfamily", width: 150, sortable: true },
    { id: "OPMFamily", name: "OPMFamily", field: "OPMFamily", width: 150, sortable: true },
    { id: "OPMSpecies", name: "OPMSpecies", field: "OPMSpecies", width: 150, sortable: true }
  ];

  var options = {
    rowHeight: 24,
    editable: false,
    enableAddRow: false,
    enableCellNavigation: false,
    enableColumnReorder: false
  };

  var loadingIndicator = null;


  $(function () {
    grid = new Slick.Grid("#myGrid", loader.data, columns, options);

    grid.onViewportChanged.subscribe(function (e, args) {
      var vp = grid.getViewport();
      loader.ensureData(vp.top, vp.bottom);
    });

    grid.onSort.subscribe(function (e, args) {
      loader.setSort(args.sortCol.field, args.sortAsc ? 1 : -1);
      var vp = grid.getViewport();
      loader.ensureData(vp.top, vp.bottom);
    });

    loader.onDataLoading.subscribe(function () {
      if (!loadingIndicator) {
        loadingIndicator = $("<span class='loading-indicator'><label>Buffering...</label></span>").appendTo(document.body);
        var $g = $("#myGrid");

        loadingIndicator
            .css("position", "absolute")
            .css("top", $g.position().top + $g.height() / 2 - loadingIndicator.height() / 2)
            .css("left", $g.position().left + $g.width() / 2 - loadingIndicator.width() / 2);
      }

      loadingIndicator.show();
    });

    loader.onDataLoaded.subscribe(function (e, args) {
      for (var i = args.from; i <= args.to; i++) {
        grid.invalidateRow(i);
      }

      grid.updateRowCount();
      grid.render();

      loadingIndicator.fadeOut();
    });

    $("#txtSearch").keyup(function (e) {
      if (e.which == 13) {
        loader.setSearch($(this).val());
        var vp = grid.getViewport();
        loader.ensureData(vp.top, vp.bottom);
      }
    });

    loader.setSearch($("#txtSearch").val());
    loader.setSort("pdbid", 1);

    grid.registerPlugin( 
    	new Slick.AutoTooltips({ enableForHeaderCells: true })
	);

    // load the first page
    grid.onViewportChanged.notify();
  })
</script>

{%endblock%}
